---
title: "P8123_final_project"
author: "Chenxi Liu"
date: "12/12/2021"
output: pdf_document
---

```{r setup, include=FALSE}
library(haven)
library(tidyverse)
library(survey)
```


```{r}
bmi_data = read_xpt(
  "./data/BMX_G.XPT"
  ) %>% select (SEQN, BMXBMI, BMDBMIC) %>%
  rename(BMI = BMXBMI) %>%
  mutate(child_BMI = 
           case_when(BMDBMIC == 1 ~"Underweight",
            BMDBMIC == 2 ~ "Normal",
            BMDBMIC == 3 ~ "Overweight",
            BMDBMIC == 4 ~ "Obese")) %>%
  select(SEQN, BMI, child_BMI) %>%
  drop_na(BMI)

demo = read_xpt(
  "./data/DEMO_G.XPT"
  ) %>%
  select(SEQN, RIAGENDR, RIDAGEYR, RIDRETH1, INDFMPIR, SDMVPSU, SDMVSTRA) %>%
  rename(PIR = INDFMPIR,
         PSU = SDMVPSU,
         strata = SDMVSTRA,
         age = RIDAGEYR) %>%
  mutate(sex = case_when(RIAGENDR == 1 ~"Male",
                         RIAGENDR == 2 ~ "Female"),
         age_group = case_when(age >= 6 & age < 12 ~ "6 – 12",
                         age >= 12 & age < 20 ~ "12 to <20",
                         age >= 20 & age < 40 ~ "20 to <40",
                         age >= 40 & age < 60 ~ "40 to <60",
                         age >=60 & age <= 80 ~"60 - 80"),
        race = case_when(RIDRETH1 == 1 ~ "Mexican American",
                         RIDRETH1 == 2 ~"Other Hispanic",
                         RIDRETH1 ==3 ~"Non-Hispanic White",
                         RIDRETH1 == 4 ~ "Non-Hispanic Black",
                         RIDRETH1 == 5 ~ "Other race/multiracial" )) %>%
  select(SEQN, PSU, strata, sex, age_group, age, race, PIR)

t_data = read_xpt(
  "./data/TST_G.XPT"
  ) %>%
  drop_na() %>%
  rename(T = LBXTST)

# final merged dataset
survey_df = read_xpt(
  "./data/PHTHTE_G.XPT"
  ) %>%
  drop_na() %>%
  inner_join(t_data, by = "SEQN") %>%
  left_join(demo, by = "SEQN") %>%
  left_join(bmi_data, by = "SEQN")
```

## Table 1. Population Characteristics in NHANES Participants With Phthalate and T Data 2011–2012 (n = 2208)

\begin{tabular}{lll}
\hline & & Weighted Median \\
& n & (25th, 75th (Weighted \%) Percentile) \\
\hline Age group, y & & $41(23,56)$ \\
$6-12$ & $293(6.63)$ & \\
12 to $<20$ & $351(12.0)$ & \\
20 to $<40$ & $572(29.5)$ & \\
40 to $<60$ & $507(31.6)$ & \\
$60-80$ & $485(20.2)$ & \\
Sex & & \\
Female & $1098(51.3)$ & \\
Male & $1110(48.7)$ & \\
Race/ethnicity & & \\
Mexican American & $277(8.82)$ & \\
Other Hispanic & $232(7.14)$ & \\
Non-Hispanic white & $742(64.6)$ & \\
Non-Hispanic black & $573(12.2)$ & \\
Other race/multiracial & $384(7.20)$ & \\
PIR continuous & & $2.72(1.26,4.76)$ \\
(no units) & & \\
BMI continuous, kg/m $^{2}$ & & $26.5(22.8,31)$ \\
Child/adolescent BMI & & \\
$\quad$ categories $^{2}$ & & \\
Underweight & $18(2.86)$ & \\
Normal weight & $370(57.8)$ & \\
Overweight & $109(17.7)$ & \\
Obese & $141(21.6)$ & \\
\hline
\end{tabular}

```{r}
table_1 = survey_df %>%
  select(SEQN,  sex, age_group, age, race, PIR, BMI, child_BMI)
table_1 %>% count(age_group) 
table_1 %>% count(sex) 
table_1 %>% count(race) 
table_1 %>% drop_na(child_BMI) %>% count(child_BMI) 
```



